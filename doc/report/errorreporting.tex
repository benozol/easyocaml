
\section{Errors and Error Reporting Adaptibility}
\label{sec:errors}

EasyOCaml is essentially build for teaching programming . A such special
attention is paid to the way errors are reported to achieve the following
goals:

Firstly, errors should provide a right amount of details, too few information
is of course insufficient, but also too much information can be confusing. So,
for example in type constructor clashes exactly those locations are reported,
which are essential to the error.  Delivering more information on the reasons
of type errors is exactly what EasyOCaml's type checker is made for.

Secondly, error reporting should be adaptable: For a beginner, reading 
errors in a foreign language can distract or even prevent him from 
understanding an error. Furthermore, the error output should be adaptable in
its overall structure to serve as the input for different kinds of
presentation, e.g. plain text on command line or HTML to display it in a web
browser.

The last section has explained the improvements of \easyocaml\ to type 
error messages. I will describe the changes to the parser to build a foundation
to include more information with the parsing errors below and the error
adaption possibilities subsequently.


\subsection{New Errors for Camlp4}
\label{hd003001}
As mentioned, \easyocaml\ parses its input with a \camlpf\ parser.  
Unfortunately, \camlpf's error messages are hard coded in English and never
represented in data.  This is because \camlpf\ is a OCaml stream parser in its
core, and this requires parsing errors to be reported as exceptions which only
allow just a string for information\ttfootnote[exception ]{Stream.Error of
string}.

Nevertheless, we supplied \camlpf\ with a new error reporting system, up 
to now just to make error reporting adaptable, but it should be possible 
now to augment the information of parse errors with more information on the
state of the parser. A parsing error\ttfootnote[type ]{ParseError.t} is one of
the following:

\begin{description}
    \item[\texttt{Expected~(entry,~opt\_before,~context)}] is raised 
        if when the parser stucks while parsing a phrase: \texttt{entry} 
        describe the categories of the possible, expected subphrases, 
        \texttt{opt\_before} might describe the category of the entry 
        just parsed and \texttt{context} denotes the category of the 
        phrase which contains the entry.
    \item[\texttt{Illegal\_begin~sym}] is raised when the parser is 
        not able to parse the top categories described by \texttt{sym}.
    \item[\texttt{Failed}] is raised only in 
        \texttt{Camlp4.Struct.Grammar.Fold}.
    \item[\texttt{Specific\_error~err}] Beside the generic parsing 
        errors just mentioned, it is possible to extend the parsing 
        errors per language by ``artificial'' errors which are specific 
        to a language, e.g. currified constructor in OCaml, which is not
        represented in the grammar but checked in code.  (further errors for
        EasyOCaml are specified in subsection \ref{mod:ocamlspecificerrors}.)
\end{description}

How are these errors represented in the string information of the stream error?
Not without a hack, which is luckily hidden behind the interface of Camlp4:
Internally, the parsing exception contains a string of the format
``\texttt{<msg>\textbackslash 000<mrsh>}'' where \texttt{<msg>} is
the usual Camlp4 error message and \texttt{<mrsh>} is the marshalled parsing
error as just described.
This string is again decomposed in the interface function for
parsing\ttfootnote[function ]{Camlp4.Struct.Grammar.Entry.action\_parse}, and reported as
a parsing error\ttfootnote[type ]{ParseError.t} to the user.

And so \camlpf's parsing errors now represented in data to apply error
reporting adaptabilities and to further extend it to contain more informations.


\subsection{Adaptibility}
\label{hd003002}
For internationalization of error messages and different structures of error
messages for different display settings, EasyOCaml provides adaptability of
error messages by a plugin system.  Error reporting plugins should use
\texttt{EzyError}`s internationalized functions to output the error's
description (\texttt{EzyErrors.print*\_desc}) to keep them uniform but can
print it any structure:  Currently, a plain text format is default and a HTML
printer which highlights the locations of an error in source code and a
XML/Sexp printer for usage in an IDE are delivered with EasyOCaml.

The user can register an error printer via the command line flag 
\texttt{-easyerrorprinter}.  The module is dynamically linked and 
registers itself with \texttt{EzyErrors.register} where appropriate 
functions are overwritten.

The following section describes the tools which EasyOCaml provides 
specifically for teaching programming.
